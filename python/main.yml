---
# https://github.com/pyenv/pyenv/wiki#suggested-build-environment
- name: Make sure python build dependencies are installed
  shell: |
    apt-get install -y build-essential libssl-dev zlib1g-dev \
      libbz2-dev libreadline-dev libsqlite3-dev curl \
      libncursesw5-dev xz-utils tk-dev libxml2-dev libxmlsec1-dev libffi-dev liblzma-dev
  become: true
  when: os == "linux"
  tags: [python, install, deps]

- name: Clone pyenv repository
  shell: git clone --depth 1 https://github.com/pyenv/pyenv.git ~/.pyenv && cd ~/.pyenv && src/configure && make -C src
  when: os == "linux" or os == "darwin"
  tags: [python, pyenv]
  register: pyenv_clone
  failed_when: false
  changed_when: result.rc == 0

- name: Clone pyenv-virtualenv plugin
  shell: git clone https://github.com/pyenv/pyenv-virtualenv.git "$(pyenv root)/plugins/pyenv-virtualenv"
  when: os == "linux" or os == "darwin"
  tags: [python, pyenv]
  register: pyenv_virtualenv_clone
  failed_when: false
  changed_when: result.rc == 0
