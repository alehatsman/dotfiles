---
# https://github.com/pyenv/pyenv/wiki#suggested-build-environment
- name: Make sure python build dependencies are installed
  shell: |
    apt-get install -y build-essential libssl-dev zlib1g-dev \
      libbz2-dev libreadline-dev libsqlite3-dev curl \
      libncursesw5-dev xz-utils tk-dev libxml2-dev libxmlsec1-dev libffi-dev liblzma-dev
  become: true
  when: os == "linux"
  tags: [python, install, deps]

- name: Clone pyenv repository
  shell: |
    if [ ! -d ~/.pyenv ]; then
      git clone --depth 1 https://github.com/pyenv/pyenv.git ~/.pyenv && \
      cd ~/.pyenv && \
      src/configure && \
      make -C src
    fi
  when: os == "linux" or os == "darwin"
  tags: [python, pyenv]

- name: Clone pyenv-virtualenv plugin
  shell: |
    if [ ! -d ~/.pyenv/plugins/pyenv-virtualenv ]; then
      git clone https://github.com/pyenv/pyenv-virtualenv.git "$(pyenv root)/plugins/pyenv-virtualenv"
    fi
  when: os == "linux" or os == "darwin"
  tags: [python, pyenv]
